# 글로벌 뉴스 지형도 - 완성 가이드

## 🎉 모든 기능 통합 완료!

`topic_sonar_complete.html` - 프로덕션 레디 버전

---

## 📋 통합된 기능 목록

### ✅ 1. 날짜 슬라이더
- **기능**: 최근 30일 데이터 탐색
- **UI**: 헤더 바로 아래 슬라이더
- **사용법**:
  - 슬라이더 드래그로 날짜 선택
  - 날짜 입력 필드에 직접 입력
  - "오늘" 버튼으로 최신 데이터로 복귀

### ✅ 2. 국가 필터
- **기능**: 특정 국가만 표시
- **UI**: 우측 필터 패널
- **국가**: 미국🇺🇸, 영국🇬🇧, 한국🇰🇷, 독일🇩🇪 등
- **다중 선택**: 여러 국가 동시 체크 가능

### ✅ 3. 성향 필터
- **기능**: 비판/중립/지지 필터링
- **UI**: 필터 패널 하단
- **색상**:
  - 🔴 비판적 (0-33점)
  - ⚪ 중립 (34-66점)
  - 🟢 지지 (67-100점)

### ✅ 4. 실시간 검색
- **기능**: 토픽 제목 검색
- **UI**: 헤더 우측 검색창
- **동작**: 타이핑하면 실시간 필터링

### ✅ 5. 팬 & 줌
- **마우스**:
  - 드래그: 지도 이동
  - 휠: 줌 인/아웃
- **터치**:
  - 1손가락 드래그: 이동
  - 2손가락 핀치: 줌
- **버튼**: 우측 하단 +/−/⊙

### ✅ 6. 모바일 최적화
- **반응형**: 768px 이하 자동 조정
- **터치**: 핀치 줌, 드래그 지원
- **UI**: 작은 화면용 레이아웃

### ✅ 7. 3-레이어 시스템
- **Layer 1**: 개별 기사 (국가별 색상)
- **Layer 2**: 국내 토픽 (1개국)
- **Layer 3**: 글로벌 메가 (3+ 개국)
- **토글**: 좌측 패널에서 켜고 끄기

### ✅ 8. 랜덤 소나 펄스
- **자동**: 3-7초마다 1-2개 메가토픽
- **수동**: "펄스" 버튼 클릭
- **효과**: 이중 동심원, 관심 유도

---

## 🎮 사용 방법

### 기본 탐색
```
1. 페이지 로드 → 자동으로 오늘 데이터 표시
2. 마우스 호버 → 토픽 정보 툴팁
3. 토픽 클릭 → 상세 페이지 이동 (/topics/{id})
4. 드래그 → 지도 이동
5. 휠/핀치 → 줌 인/아웃
```

### 과거 데이터 보기
```
1. 날짜 슬라이더 드래그 또는
2. 날짜 입력 필드 클릭 → 캘린더 선택
3. "오늘" 버튼으로 복귀
```

### 필터링
```
1. "필터" 버튼 클릭 → 우측 패널 열기
2. 국가 체크/해제
3. 성향 체크/해제
4. 검색창에 키워드 입력
5. 실시간 반영됨
```

### 레이어 제어
```
1. 좌측 패널에서 체크박스 클릭
2. "기사" 해제 → 토픽만 보임
3. "국내" 해제 → 글로벌만 보임
4. "글로벌" 해제 → 국내만 보임
```

---

## 🖥️ 설정 방법

### 1. 로컬 테스트
```bash
# Next.js dev 서버 실행
cd app/frontend
npm run dev

# 브라우저에서 열기
open http://localhost:3000/topic_sonar_complete.html
```

### 2. 프로덕션 배포
```bash
# HTML 파일을 public/ 폴더로 이동
cp topic_sonar_complete.html app/frontend/public/map.html

# 또는 Next.js 페이지로 통합
# app/frontend/src/app/map/page.tsx 생성
```

### 3. API 엔드포인트
**필수**: `/api/topics` 엔드포인트가 다음 데이터를 반환해야 함:
```json
[
  {
    "id": 1,
    "title": "토픽 제목",
    "title_kr": "한글 제목",
    "article_count": 10,
    "country_count": 3,
    "avg_stance_score": 52,
    "centroid_embedding": [...],  // 768D 배열
    "countries": ["US", "UK", "KR"]
  }
]
```

---

## 📊 성능 최적화

### 데이터 제한
- 토픽당 최대 15개 기사 (성능 고려)
- 최소 3개 기사 있는 토픽만 표시
- 임베딩 있는 토픽만 사용

### 렌더링 최적화
- Canvas 기반 (DOM보다 빠름)
- 60fps 목표
- 스프링 애니메이션 (부드러움)
- 점진적 로딩 (순차 등장)

### 모바일 최적화
- 터치 이벤트 네이티브 지원
- 핀치 줌 하드웨어 가속
- viewport 고정 (확대 방지)
- 작은 UI 요소 (공간 절약)

---

## 🐛 알려진 제한사항

### 1. 날짜 슬라이더
- **현재**: UI만 있음, 실제 날짜별 데이터 로드는 미구현
- **해결**: API에 `?date=YYYY-MM-DD` 파라미터 추가 필요

### 2. 임베딩 차원 축소
- **현재**: 간소화된 PCA 사용 (빠르지만 정확도 낮음)
- **개선**: 서버에서 t-SNE 미리 계산해서 전달

### 3. 기사 위치
- **현재**: 토픽 주변에 랜덤 산포
- **개선**: 실제 기사 임베딩 기반 위치

### 4. 토픽 이동 경로
- **현재**: 미구현
- **개선**: 날짜 변경 시 토픽 이동 트레일 표시

---

## 🔧 커스터마이징

### 색상 변경
```javascript
// 라인 358-362
const COUNTRY_COLORS = {
    'US': '#ef4444',  // 빨강
    'UK': '#3b82f6',  // 파랑
    'KR': '#8b5cf6',  // 보라
    // ... 원하는 색상으로 변경
};
```

### 펄스 빈도 조절
```javascript
// 라인 1088
const delay = 3000 + Math.random() * 4000; // 3-7초
// 수정 예: 5000 + Math.random() * 5000; // 5-10초
```

### 줌 범위 조절
```javascript
// 라인 1048
scale = Math.max(0.5, Math.min(3, scale)); // 0.5x ~ 3x
// 수정 예: Math.max(1, Math.min(5, scale)); // 1x ~ 5x
```

---

## 🚀 다음 개선 방향

### 우선순위 높음
1. **날짜별 데이터 로드** - API 파라미터 추가
2. **토픽 이동 경로** - 시간에 따른 변화 시각화
3. **서버 사이드 t-SNE** - 정확한 위치 계산

### 우선순위 중간
4. **공유 기능** - URL 파라미터로 상태 저장
5. **즐겨찾기** - 관심 토픽 북마크
6. **알림** - 중요 토픽 발생 시 알림

### 우선순위 낮음
7. **3D 모드** - Three.js 기반 3차원 지형
8. **AR 모드** - 모바일 AR 지원
9. **애니메이션 내보내기** - 토픽 이동 동영상

---

## 📝 체크리스트

배포 전 확인사항:

- [ ] Next.js dev 서버 정상 작동
- [ ] `/api/topics` 엔드포인트 응답 확인
- [ ] 데스크톱 Chrome/Safari/Firefox 테스트
- [ ] 모바일 iOS/Android 테스트
- [ ] 터치 제스처 (핀치/드래그) 테스트
- [ ] 필터 동작 확인
- [ ] 검색 동작 확인
- [ ] 토픽 클릭 → 상세 페이지 이동 확인
- [ ] 펄스 애니메이션 확인
- [ ] 로딩/에러 상태 확인

---

## 💡 팁

### 개발자 도구
- **Console 열기**: F12 또는 Cmd+Option+I
- **네트워크 탭**: API 요청 확인
- **성능 탭**: FPS 모니터링

### 디버깅
```javascript
// 콘솔에서 직접 실행 가능
console.log('Mega Topics:', megaTopics.length);
console.log('National Topics:', nationalTopics.length);
console.log('Articles:', articles.length);
console.log('Current Scale:', scale);
```

### 빠른 리셋
- **리셋 버튼**: 모든 상태 초기화
- **페이지 새로고침**: F5
- **캐시 삭제**: Cmd+Shift+R (Mac) / Ctrl+Shift+R (Win)

---

## 📞 문제 해결

### "데이터 로드 실패"
→ Next.js dev 서버가 실행 중인지 확인
→ `/api/topics` 엔드포인트 응답 확인

### "아무것도 안 보임"
→ 필터가 전부 해제되었는지 확인
→ 레이어가 전부 꺼져있는지 확인
→ 콘솔에서 에러 메시지 확인

### "너무 느림"
→ 기사 수 제한 줄이기 (라인 947: 15 → 10)
→ 토픽 최소 기사 수 늘리기 (라인 875: 3 → 5)

### "모바일에서 안 움직임"
→ `touch-action: none` 확인
→ 터치 이벤트 리스너 확인
→ Safari의 경우 `preventDefault()` 확인

---

완성입니다! 🎉
